# covid19-slack-py

## COVID-19 Slackアプリ（Python版）

本アプリは、Slack APIチュートリアル「NodeJSとSlack APIによるいまどきのネットワークプログラミング」の中で用いた全ての要素部品を組み合わせて、対象国の新型コロナウィルスの感染状況を、Slack上でテキスト、表、画像から構成されるレポートをPDFファイル形式として出力する。
同じ機能をPythonに移植したものである。

### 主な搭載機能

- 選択メニューを用いて、対象となる国を約200ヶ国の中から選択する
- 対象国の情報と感染状況を出力する
- 感染者数と死亡者数の履歴をCSVファイルで出力する
- 30日間の感染者数と死亡者数の推移をグラフ表示する
- モーダルビューを通してコメントを登録する
- 国の情報、感染状況、グラフ画像、注釈を一つのPDFファイルとして出力する
- 英語表記の国名を日本語表記に変換する

### スラッシュコマンド

- /covid19 <国名 オプション>
  指定した国の感染状況を表形式で表示する。国名を指定しなければ約200ヶ国からなる選択メニューの中から選択させ、テキスト、画像、PDFファイルで内容を提示する。
- /hello
  時刻に応じた挨拶文を返答し、直近の日本の新規感染者数をグラフで表示する
- /translate <国名>
  指定した国名（英語表記）を日本語表記に変換する

[動作確認の手順] Windows環境の場合

1. Pythonをインストールする
1. 各スラッシュコマンドが準備したSlackアプリに登録されていることを確認する
1. コマンドプロンプトを開き、ダウンロードしたフォルダへ移動する
1. pip installコマンドでアプリに依存するパッケージをインストールする
    $ pip install -r requirements.txt
1. env.tplファイルの環境変数SLACK_BOT_TOKENとSLACK_APP_TOKENに作成したSlackアプリのユーザートークンとアプリトークンを設定する
1. env.tplファイルの環境変数DB_URLに接続するPostgreSQLのデータベース接続先を設定する
    postgres://<ユーザー名>:<パスワード>@<サーバー名>:<ポート番号>/<データベース名>
1. env.tplのファイル拡張子をbatに変更し、バッチファイルとする
1. コマンドプロンプト上でバッチファイルを実行する
    $ env.bat
1. Pythonアプリを起動する
    $ python ./app.py
1. Slackアプリをインストールしたチャネルのメッセージ欄に「/covid19」と入力し、送信する
1. 選択メニューから適当な国を選ぶ
1. 該当国の感染状況の下に[全世界]、[推移グラフ]、[レポート作成]などボタンが配置されていることを確認する
1. 各ボタンをクリックして実行する

[制限・未対応]

1. 画像ファイルに表示される線グラフのスムージングに未対応
1. PDFファイルに出力するコメントは2ページ目のみに対応
1. PDFファイルに出力するコメントは改行せずに表からはみ出す
